#include <malloc.h>
#include <string.h>
#include <stdio.h>
#include <stdlib.h>

char *add_char_to_out(char *old, char to_add) {
  int len = strlen(old);
  char *new = malloc(len == 0 ? (sizeof(char) * 2) : (sizeof(char) * (len + 2))); // + 2
  char *p2 = old;

  for (int i = 0; i < len; i++) {
    new[i + 1] = p2[i];
  }
  new[0] = to_add;
  new[len + 1] = '\0';

  free(old);
  return new;
}

char *add_leading_zeroes(char *str, int old_len, int new_len) {
  int diff = abs(new_len - old_len);
  char *new_str = malloc(sizeof(char) * (new_len + 1));

  for (int i = 0; i < new_len; i++) {
    new_str[i] = '0';
  }
  for (int i = 0; i < old_len; i++) {
    new_str[i + diff] = str[i];
  }
  new_str[new_len] = '\0';

  return new_str;
}

char *remove_leading_zeroes(char *str) {
  int len = 1, index = 0;
  char *p = str, *new_str = malloc(sizeof(char) * len);
  new_str[0] = '\0';

  while (*p == '0' && *p != '\0') {
    p++;
  }
  if (*p == '\0') {
    p--;
  }
  

  while (*p != '\0') {
    new_str = realloc(new_str, ++len);
    new_str[index] = *p;
    index++;
    p++;
  }
  new_str[len - 1] = '\0';

  free(str);
  return new_str;
}

char *strsum(const char *a, const char *b) {
  int overflow = 0;
  int len_a = strlen(a), len_b = strlen(b);
  int len = len_a;
  char *acpy = malloc(sizeof(char) * len_a), *bcpy = malloc(sizeof(char) * len_b);
  char *res = malloc(sizeof(char));
  res[0] = '\0';

  // copy strings
  strcpy(acpy, a);
  strcpy(bcpy, b);
  // determine shorter string
  if (len_a > len_b) {
    bcpy = add_leading_zeroes(bcpy, len_b, len_a);
    len = len_a;
  } else if (len_a < len_b) {
    acpy = add_leading_zeroes(acpy, len_a, len_b);
    len = len_b;
  }
  
  for (int i = len - 1; i >= 0 || overflow == 1; i--) {
    int partial_sum = overflow;
    if (i >= 0) {
      partial_sum += (acpy[i] - '0') + (bcpy[i] - '0');
    }
    

    if (partial_sum >= 10) {
      int rest = partial_sum % 10;
      overflow = partial_sum / 10;
      res = add_char_to_out(res, rest + '0');
    } else {
      res = add_char_to_out(res, partial_sum + '0');
      overflow = 0;   
    }
  }

  res = remove_leading_zeroes(res);
  // move array pointer to first non-zero or last char in string
  return res;
}

int main() {
  char *res1 = NULL;

  res1 = strsum("123", "456");
  printf("Result: %s\n", res1);
  free(res1);
  res1 = strsum("800", "9567");
  printf("Result: %s\n", res1);
  free(res1);
  res1 = strsum("00001", "9");
  printf("Result: %s\n", res1);
  free(res1);
  res1 = strsum("", "");
  printf("Result: %s\n", res1);
  free(res1);
  res1 = strsum("252468490288652025588515624217890037383398866966906441175250493698057730405117703124843578007476679773393381288235042524684902886520255885156242178900373833988669669064411752504936980577304051177031248435780074766797733933812882350425246849028865202558851562421789003738339886696690644117525049369805773040511770312484357800747667977339338128823504504936980577304051177031248435780074766797733933812882350500987396115460810235406249687156014953359546786762576470085049369805773040511770312484357800747667977339338128823505009873961154608102354062496871560149533595467867625764700825246849028865202558851562421789003738339886696690644117525049369805773040511770312484357800747667977339338128823504504936980577304051177031248435780074766797733933812882350500987396115460810235406249687156014953359546786762576470085049252468490288652025588515624217890037383398866966906441175250493698057730405117703124843578007476679773393381288235042524684902886520255885156242178900373833988669669064411752504936980577304051177031248435780074766797733933812882350425246849028865202558851562421789003738339886696690644117525049369805773040511770312484357800747667977339338128823504504936980577304051177031248435780074766797733933812882350500987396115460810235406249687156014953359546786762576470085049369805773040511770312484357800747667977339338128823505009873961154608102354062496871560149533595467867625764700825246849028865202558851562421789003738339886696690644117525049369805773040511770312484357800747667977339338128823504504936980577304051177031248435780074766797733933812882350500987396115460810235406249687156014953359546786762576470085049369805773040511770312484357800747667977339338128823505009873961154608102354062496871560149533595467867625764700825246849028865202558851562421789003738339886696690644117525049369805773040511770312484357800747667977339338128823504252468490288652025588515624217890037383398866966906441175250493698057730405117703124843578007476679773393381288235042524684902886520255885156242178900373833988669669064411752504936980577304051177031248435780074766797733933812882350450493698057730405117703124843578007476679773393381288235050098739611546081023540624968715601495335954678676257647008504936980577304051177031248435780074766797733933812882350500987396115460810235406249687156014953359546786762576470082524684902886520255885156242178900373833988669669064411752504936980577304051177031248435780074766797733933812882350450493698057730405117703124843578007476679773393381288235050098739611546081023540624968715601495335954678676257647008504936980577304051177031248435780074766797733933812882350500987396115460810235406249687156014953359546786762576470082524684902886520255885156242178900373833988669669064411752504936980577304051177031248435780074766797733933812882350425246849028865202558851562421789003738339886696690644117525049369805773040511770312484357800747667977339338128823504252468490288652025588515624217890037383398866966906441175250493698057730405117703124843578007476679773393381288235045049369805773040511770312484357800747667977339338128823505009873961154608102354062496871560149533595467867625764700850493698057730405117703124843578007476679773393381288235050098739611546081023540624968715601495335954678676257647008252468490288652025588515624217890037383398866966906441175250493698057730405117703124843578007476679773393381288235045049369805773040511770312484357800747667977339338128823505009873961154608102354062496871560149533595467867625764700850493698057730405117703124843578007476679773393381288235050098739611546081023540624968715601495335954678676257647008252468490288652025588515624217890037383398866966906441175250493698057730405117703124843578007476679773393381288235042524684902886520255885156242178900373833988669669064411752504936980577304051177031248435780074766797733933812882350425246849028865202558851562421789003738339886696690644117525049369805773040511770312484357800747667977339338128823504504936980577304051177031248435780074766797733933812882350500987396115460810235406249687156014953359546786762576470085049369805773040511770312484357800747667977339338128823505009873961154608102354062496871560149533595467867625764700825246849028865202558851562421789003738339886696690644117525049369805773040511770312484357800747667977339338128823504504936980577304051177031248435780074766797733933812882350500987396115460810235406249687156014953359546786762576470085049369805773040511770312484357800747667977339338128823505009873961154608102354062496871560149533595467867625764700825246849028865202558851562421789003738339886696690644117525049369805773040511770312484357800747667977339338128823504252468490288652025588515624217890037383398866966906441175250493698057730405117703124843578007476679773393381288235042524684902886520255885156242178900373833988669669064411752504936980577304051177031248435780074766797733933812882350450493698057730405117703124843578007476679773393381288235050098739611546081023540624968715601495335954678676257647008504936980577304051177031248435780074766797733933812882350500987396115460810235406249687156014953359546786762576470082524684902886520255885156242178900373833988669669064411752504936980577304051177031248435780074766797733933812882350450493698057730405117703124843578007476679773393381288235050098739611546081023540624968715601495335954678676257647008504936980577304051177031248435780074766797733933812882350500987396115460810235406249687156014953359546786762576470083698057730405117703124843578007476679773393381288235050098739611546081023540624968715601495335954678676257647008", "252468490288652025588515624217890037383398866966906441175250493698057730405117703124843578007476679773393381288235042524684902886520255885156242178900373833988669669064411752504936980577304051177031248435780074766797733933812882350425246849028865202558851562421789003738339886696690644117525049369805773040511770312484357800747667977339338128823504");
  printf("Result: %s\n", res1);
  free(res1);
  

  return 0;
}